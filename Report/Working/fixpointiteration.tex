\documentclass[]{article}
\usepackage[margin=1in]{geometry}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{amsfonts}
\usepackage{tikz}
\usepackage{eurosym}
\usepackage{algorithm}
\usepackage{algorithmicx}
\usepackage{algpseudocode}

\DeclareRobustCommand{\officialeuro}{%
	\ifmmode\expandafter\text\fi
	{\fontencoding{U}\fontfamily{eurosym}\selectfont e}}
\usepackage{caption}
\usepackage{subcaption}
\usetikzlibrary{matrix}

\usepackage{stmaryrd}
\newtheorem{definition}{Definition}[section]
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}



%opening
\title{Verifying Featured Transition Systems using Variability Parity Games}
\author{Sjef van Loo}

\begin{document}
	\section{Pessimistic game}
		Given VPG $G = (V,V_0,V_1,E,\Omega, \mathfrak{C},\theta)$, we can create a PG for $G$ that is pessimistic for player $\alpha \in \{0,1\}$, denoted $G_{\triangleright\alpha}$. We have
		
		\[ G_{\triangleright\alpha} = \{V,V_0,V_1,E',\Omega \} \]
		such that
		\[ E' = \{ (v,w) \in E\ |\ v \in V_{\overline{\alpha}} \vee \theta(v,w) \supseteq \mathfrak{C} \} \]
		
		Pessimistic games can have deadlocks.
		
Let $G$ be a VPG with configurations $\mathfrak{C}$. Let $W_0^c$ and $W_1^c$ be the winning sets for $G$ for some configuration $c \in \mathfrak{C}$.

Claim: Given winning set $W_\alpha$ for game $G_{\triangleright\alpha}$ we have $W_\alpha \subseteq W_\alpha^c$.

Given $v \in W_\alpha$, to prove: $v \in W_\alpha^c$. Every strategy played by player $\alpha$ in game $G_{\triangleright\alpha}$ can also be played in game $G$. Every strategy played by player $\overline{\alpha}$ in game $G$ can also be played in game $G_{\triangleright\alpha}$.

\section{Fixpoint iteration}
Given VPG $G = (V,V_0,V_1,E,\Omega, \mathfrak{C}, \theta)$ we define subgame $G \cap \mathfrak{C}' = (V,V_0,V_1,E,\Omega,\mathfrak{C} \cap \mathfrak{C}',\theta)$.

Assume priorities are compressed such that the distinct priorities are exactly $0,\dots,d-1$. We can solve VPG $G$ by calling $\textsc{FixpointIterMBR}(G, V,\emptyset)$.
\begin{algorithm}
	\caption{$\textsc{FixpointIterMBR}(\textit{VPG }G, I_\nu, I_\mu)$}
	\begin{algorithmic}[1]
		\If{$|\mathfrak{C}| = 1$}
			\State $W_0 \gets \textsc{FixpointIter}(G,d-1,I_\nu,I_\mu)$
			\State \Return $(\mathfrak{C} \times W_0, \mathfrak{C} \times (V \backslash W_0))$
		\EndIf
		\State $P_0 \gets \textsc{FixpointIter}(G_{\triangleright0},d-1,I_\nu,I_\mu)$
		\State $P_1 \gets \textsc{FixpointIter}(G_{\triangleright1},d-1,I_\nu,I_\mu)$
		\State $(\mathfrak{C}^a,\mathfrak{C}^b) \gets$ partition $\mathfrak{C}$ in non-empty parts
		\State $(W_0^a, W_1^a) \gets \textsc{FixpointIterMBR}(G \cap \mathfrak{C}^a,P_1,P_0)$
		\State $(W_0^b, W_1^b) \gets \textsc{FixpointIterMBR}(G \cap \mathfrak{C}^b,P_1,P_0)$
		\State $W_0 \gets W_0^a \cup W_0^b$
		\State $W_1 \gets W_1^a \cup W_1^b$
		\State \Return $(W_0,W_1)$
	\end{algorithmic}
\end{algorithm}
\begin{algorithm}
\caption{$\textsc{FixpointIter}(\textit{PG } G, i, I_\nu, I_\mu)$}
\begin{algorithmic}[1]
	\If{$i=-1$}
		\State \Return $\{ v \in V_0\ |\ \exists w \in V: (v,w) \in E \wedge w \in X_{\Omega(w)}\}\cup \{ v \in V_1\ |\ \forall w \in V : (v,w) \implies w \in X_{\Omega(w)} \}$
	\Else
		\State $X_i \gets I_\nu$ if $i$ is even $I_\mu$ otherwise
		\Repeat
			\State $X_i' \gets X_i$
			\State $X_i \gets\textsc{FixpointIter}(G, i-1,I_\nu, I_\mu)$
		\Until{$X_i = X_i'$}
		\State \Return $X_i$
	\EndIf
\end{algorithmic}
\end{algorithm}
\[ F_0 = \{ v \in V_0\ |\ \exists w \in V: (v,w) \in E \wedge w \in X_{\Omega(w)}\}\cup \{ v \in V_1\ |\ \forall w \in V : (v,w) \implies w \in X_{\Omega(w)} \} \]
\[ W_0 = \sigma X_{d-1}\dots \mu X_1. \nu X_0.F_0 \]
Every $X_i$ has fixpoint operator $\nu$ if $i$ is even and $\mu$ if $i$ is odd.\\
Note that fixpoint iteration works for games with deadlocks.

Set $P_\alpha$ calculated by the algorithm is winning for player $\alpha$ for all configuration in $\mathfrak{C}$.

Claim: the following formula correctly calculates the winning sets for $G_{|c}$ with $c \in \mathfrak{C}$.
\[ W_0 = \sigma X_{d-1}\dots P_1 \cap \mu X_1. P_0 \cup \nu X_0.P_1 \cap F_0  \]
From which we can conclude that it is correct to let least fixed point variables start at $P_0$ and greatest fixed point variables at $P_1$.
\end{document}